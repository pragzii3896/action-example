name: add-project
# This workflow gets executed when someone opens an issue for adding a project
on:
  issues:
      types: [opened,edited]
jobs:
   add_project_job:
    name: add-project
    runs-on: ubuntu-latest
    if: startsWith( ${{ github.event.issue.title }},"add|")
    steps:
    - name: setup directory
      uses: actions/checkout@v2
    - name: setup python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
        architecture: 'x64'
    - name: install dependencies
      run: pip3 install PyGithub  
    - name: A job to add or update a project
      id: addProject
      run: | 
        echo ::set-output name=issue_comment::`python3 add_name.py '${{ github.event.issue.user.login }}' '${{ github.event.issue.body }}'`
        git config user.name shriaas2898
        git add .
        git commit -m "Added: ${{ github.event.issue.title }}"
        git push
    - uses: nick-invision/persist-action-data@v1
      with:
        data: ${{ steps.addProject.outputs.issue_comment }}
        variable: ISSUE_COMMENT
   close_issue_job:
    name: Close Issue
    runs-on: ubuntu-latest
    needs: add_project_job
    if: startsWith( ${{ github.event.issue.title }},"add|")
    steps:
    - uses: nick-invision/persist-action-data@v1
      with:
        data: ${{ steps.addProject.outputs.issue_comment }}
        retrive_variables: ISSUE_COMMENT
    - name: close issue
      uses: peter-evans/close-issue@v1
      with:
        issue-number: ${{ github.event.issue.number }}
        comment: $ISSUE_COMMENT
